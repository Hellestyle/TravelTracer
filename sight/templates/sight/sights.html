{% extends "base.html" %} 

{% block head %}
<link rel="stylesheet" type="text/css" href="{{ url_for('.static', filename='css/sights.css') }}">
<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
{% endblock %} 

{% block title %} Sights {% endblock %} 

{% block content %}
<div id="dark-overlay"></div>

<div id="img-backgroud"></div>

<div class="search-box">
  <div class="row">
    <input type="text" id="input-box" value="{{ user_input if user_input is not none else '' }}" 
    placeholder="Search the category or sight name here" autocomplete="off">
    <a href="{{ url_for('sight.sight_by_category', category='', age='') }}"><button class="search-button"><i class='bx bx-search'></i></button></a>
  </div>

  <div class="result-box"></div>
</div>

<div class="choose-age-container">
  <label for="age">Please select age group:</label>
  <!-- ages is always selected, either "all" or other age categories -->
  <select id="age" name="age">
      <option value="family_friendly">All</option>
      <option value="children">0 - 12</option>
      <option value="teenagers">13 - 19</option>
      <option value="young_adults">20 - 30</option>
      <option value="adults">31 - 60</option>
      <option value="seniors">60+</option>
  </select>
</div>

{% if message %}
  <div class="message">
    <h3> {{ message }} </h3>
  </div>
{% endif %}

{% if message %}
  <div class="back-button-container">
    <a href="{{ url_for('sight.sights') }}">
      <button class="back-button">Back</button>
    </a>
  </div>
{% endif %}

{% for i in range(0, sights|length, 3) %}

    <div class="container" style="display: {{ 'block' if loop.index <= 3 else 'none' }};">
      <div class="sights">

        {% for sight in sights[i:i+3] %}
          <a class="sight-link" href="{{ url_for('sight.sight_details', sight_id=sight.id) }}">
            <div class="sight-item">
              <img class="sight-photo" src="{{ url_for('static', filename='images/sight/' + sight.photos[0]) }}" alt="{{ sight.name }}" />
              <h3> {{ sight.name }} </h3>
              
                <div class="wishlist-and-visted-container">
                  {% if user_wishlist %}
                    {% for wishlist in user_wishlist %}
                      {% if wishlist.id == sight.id %}
                        <i class='bx bx-bookmark mark-blue' >In wishlist</i>
                      {% endif %}
                    {% endfor %}
                  {% endif %}

                  {% if user_visited_list %}
                    {% for visited in user_visited_list %}
                      {% if visited.id == sight.id %}
                        <i class='bx bx-check-circle check-green' >Visited</i>
                      {% endif %}
                    {% endfor %}
                  {% endif %}
                </div>

                <div class="info sight-info">
                  <h5>
                    {% if sight.visited == 0 %}
                      No people visited this sight yet
                    {% elif sight.visited == 1 %}
                      1 person visited this sight
                    {% else %}
                      {{ sight.visited }} people visited this sight
                    {% endif %}
                  </h5>
                  <h5>
                    {% for sight_type in sight.sight_types %}
                      <span class="sight-type"> {{ sight_type }} </span>
                    {% endfor %}
                  </h5>
                  <h5> {{ sight.age_category }} </h5>
                </div>
            </div>
          </a>
        {% endfor %}

      </div>
    </div>
  
{% endfor %}

{% if sights|length > 9 %}

  <div class="button-container">

    <button class="bn" onclick="previousPage();"> Previous </button>

    {% for i in range(0, sights|length, 9) %}
      <button class="pagination-button {{ 'pagination-button-active' if loop.index == 1 else '' }}" onclick="switchPage({{ loop.index }});"> {{ loop.index }} </button>
    {% endfor %} 

    <button class="bn" onclick="nextPage();"> Next </button>

  </div>

{% endif %}

<script src="{{ url_for('.static', filename='js/pagination.js') }}"> </script>
<script src="{{ url_for('.static', filename='js/search.js') }}"> </script>
<script src="{{ url_for('.static', filename='js/select-age.js') }}"> </script>
<script>
  initKeywords("{{ sight_type_names|join(',') }}" + "," + "{{ sight_names|join(',') }}");

  var url = {
    sight_category: "{{ url_for('sight.sight_by_category', category='_category_', age='_age_') }}",
    age_category: "{{ url_for('sight.sight_by_age', age='_age_') }}"
  };
</script>
{% endblock %}
