{% extends "base.html" %} {% block head %}

  <link rel="stylesheet" type="text/css" href="{{ url_for('.static', filename='css/sights.css') }}">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

{% endblock %} {% block title %} Sights {% endblock %} {% block content %}
<div id="dark-overlay"></div>

<div id="img-backgroud"></div>

<div class="search-box">
  <div class="row">
    <input type="text" id="input-box" 
    placeholder="Search the category or sight name here" autocomplete="off">
    <a href="{{ url_for('sight.sight_by_category', category='', age='') }}"><button class="search-button"><i class='bx bx-search'></i></button></a>
  </div>

  <div class="result-box"></div>
</div>

<div class="choose-age-container">
  <label for="age">Please select age group:</label>
  <!-- ages is always selected, either "all" or other age categories -->
  <select id="age" name="age">
      <option value="family_friendly">All</option>
      <option value="children">0 - 12</option>
      <option value="teenagers">13 - 19</option>
      <option value="young_adults">20 - 30</option>
      <option value="adults">31 - 60</option>
      <option value="seniors">60+</option>
  </select>
</div>

<!-- Just to show you -->
{% if age %}
  <div class="message">
    <h3> {{ age }} </h3>
  </div>
{% endif %}
<!-- You can delete this if you want -->

{% if message %}
  <div class="message">
    <h3> {{ message }} </h3>
  </div>
{% endif %}

{% if message %}
  <div class="back-button-container">
    <a href="{{ url_for('sight.sights') }}">
      <button class="back-button">Back</button>
    </a>
  </div>
{% endif %}

{% for i in range(0, sights|length, 3) %}

    <div class="container" style="display: {{ 'block' if loop.index <= 3 else 'none' }};">
      <div class="sights">

        {% for sight in sights[i:i+3] %}
          <a class="sight-link" href="{{ url_for('sight.sight_details', sight_id=sight.id) }}">
            <div class="sight-item">
              <img class="sight-photo" src="{{ url_for('static', filename='images/sight/' + sight.photos[0]) }}" alt="{{ sight.name }}" />
                <h3> {{ sight.name }} </h3>
                <div class="info sight-info">
                  <h5>
                    {% if sight.visited == 0 %}
                      No people visited this sight yet
                    {% elif sight.visited == 1 %}
                      1 person visited this sight
                    {% else %}
                      {{ sight.visited }} people visited this sight
                    {% endif %}
                  </h5>
                  <h5>
                    {% for sight_type in sight.sight_types %}
                      <span class="sight-type"> {{ sight_type }} </span>
                    {% endfor %}
                  </h5>
                  <h5> {{ sight.age_category }} </h5>
                </div>
            </div>
          </a>
        {% endfor %}

      </div>
    </div>
  
{% endfor %}

{% if sights|length > 9 %}

  <div class="button-container">

    <button class="bn" onclick="previousPage();"> Previous </button>

    {% for i in range(0, sights|length, 9) %}
      <button class="pagination-button {{ 'pagination-button-active' if loop.index == 1 else '' }}" onclick="switchPage({{ loop.index }});"> {{ loop.index }} </button>
    {% endfor %} 

    <button class="bn" onclick="nextPage();"> Next </button>

  </div>

{% endif %}

<script src="{{ url_for('.static', filename='js/pagination.js') }}"> </script>
<script src="{{ url_for('.static', filename='js/search.js') }} "> </script>
<script>
  initKeywords("{{ sight_type_names|join(',') }}" + "," + "{{ sight_names|join(',') }}");

  var url = {
    sight_category: "{{ url_for('sight.sight_by_category', category='_category_', age='_age_') }}",
    age_category: "{{ url_for('sight.sight_by_age', age='_age_') }}"
  };

  document.querySelector('.search-button').addEventListener('click', function(event) {
    event.preventDefault();
    var inputBoxValue = document.querySelector('#input-box').value;

    // ages is always selected, either "all" or other age categories
    var selectedAge = document.getElementById("age").value;

    // If the input box is not empty and age is either "all" or other age categories
    if (inputBoxValue && selectedAge) {
      var newHref = url.sight_category.replace('_category_', inputBoxValue).replace('_age_', selectedAge);
      window.location.href = newHref;
    } else {
      // If the input box is empty but the age is either "all" or other age categories
      var newHref = url.age_category.replace('_age_', selectedAge);
      window.location.href = newHref;
    }
  });
</script>

{% endblock %}
